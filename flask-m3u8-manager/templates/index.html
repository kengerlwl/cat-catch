{% extends "base.html" %}

{% block title %}M3U8 ä¸‹è½½ç®¡ç†å™¨ - é¦–é¡µ{% endblock %}

{% block body_class %}index-page{% endblock %}

{% block extra_head %}
<style>
    /* é¦–é¡µä¸“ç”¨æ ·å¼ */
    .index-page {
        background: var(--gradient-bg) !important;
        min-height: 100vh;
    }

    .index-page .container {
        padding-top: 2rem;
    }

    .index-header {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 2rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        text-align: center;
        color: white;
    }

    .index-header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        font-weight: 700;
    }

    .index-header .subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-bottom: 1rem;
    }

    .index-features {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-top: 1rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .index-features p {
        color: rgba(255, 255, 255, 0.9);
        margin: 0;
        font-size: 0.9rem;
    }

    /* ç¡®ä¿é¦–é¡µçš„sectionä½¿ç”¨ç™½è‰²èƒŒæ™¯ */
    .index-page section {
        background: white;
        border-radius: 0.75rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
    }
</style>
{% endblock %}

{% block content %}
<div class="index-header">
    <h1>ğŸ¬ M3U8 ä¸‹è½½ç®¡ç†å™¨</h1>
    <p class="subtitle">ç®¡ç†æ‚¨çš„è§†é¢‘ä¸‹è½½ä»»åŠ¡</p>
    <div class="index-features">
        <p>ğŸ’¡ <strong>æ–°åŠŸèƒ½ï¼š</strong>ç°åœ¨æ”¯æŒåŸŸåé…ç½®å’Œå¤§æ¨¡å‹é›†æˆï¼å¯ä»¥ä¸ºä¸åŒåŸŸåè®¾ç½®ä¸“ç”¨Headers/Cookiesï¼Œç®¡ç†æç¤ºè¯æ¨¡æ¿å’Œé…ç½®APIå‚æ•°</p>
    </div>
</div>

        <!-- è®¾ç½®é¢æ¿ -->
        <section id="settingsPanel" class="settings-panel" style="display: none;">
            <h2>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h2>
            <div class="settings-grid">
                <div class="setting-group">
                    <h3>ğŸ“¥ ä¸‹è½½è®¾ç½®</h3>
                    <div class="form-group">
                        <label for="threadCount">é»˜è®¤çº¿ç¨‹æ•°:</label>
                        <input type="number" id="threadCount" class="form-control" min="1" max="16" value="6">
                        <small>æ¯ä¸ªä»»åŠ¡çš„ä¸‹è½½çº¿ç¨‹æ•° (1-16)</small>
                    </div>
                    <div class="form-group">
                        <label for="downloadTimeout">ä¸‹è½½è¶…æ—¶ (ç§’):</label>
                        <input type="number" id="downloadTimeout" class="form-control" min="5" max="300" value="30">
                        <small>å•ä¸ªåˆ‡ç‰‡ä¸‹è½½è¶…æ—¶æ—¶é—´ (5-300ç§’)</small>
                    </div>
                    <div class="form-group">
                        <label for="maxRetryCount">æœ€å¤§é‡è¯•æ¬¡æ•°:</label>
                        <input type="number" id="maxRetryCount" class="form-control" min="0" max="10" value="3">
                        <small>ä¸‹è½½å¤±è´¥æ—¶çš„é‡è¯•æ¬¡æ•° (0-10æ¬¡)</small>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>ğŸš€ å¹¶å‘æ§åˆ¶</h3>
                    <div class="form-group">
                        <label for="maxConcurrentTasks">æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°:</label>
                        <input type="number" id="maxConcurrentTasks" class="form-control" min="1" max="10" value="2">
                        <small>åŒæ—¶è¿›è¡Œçš„ä¸‹è½½ä»»åŠ¡æ•°é‡ (1-10)</small>
                    </div>
                    <div class="queue-status-display">
                        <div class="status-item">
                            <span class="status-label">æ´»è·ƒä»»åŠ¡:</span>
                            <span id="activeTasksCount" class="status-value">0</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">æ’é˜Ÿä»»åŠ¡:</span>
                            <span id="queuedTasksCount" class="status-value">0</span>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>ğŸ¬ è½¬æ¢è®¾ç½®</h3>
                    <div class="form-group">
                        <label for="ffmpegThreads">FFmpegçº¿ç¨‹æ•°:</label>
                        <input type="number" id="ffmpegThreads" class="form-control" min="1" max="16" value="4">
                        <small>è§†é¢‘è½¬æ¢æ—¶ä½¿ç”¨çš„çº¿ç¨‹æ•° (1-16)</small>
                    </div>
                    <div class="form-group">
                        <label for="autoCleanupDays">è‡ªåŠ¨æ¸…ç†å¤©æ•°:</label>
                        <input type="number" id="autoCleanupDays" class="form-control" min="1" max="30" value="7">
                        <small>è‡ªåŠ¨æ¸…ç†å®Œæˆä»»åŠ¡çš„å¤©æ•° (1-30å¤©)</small>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>ğŸ¤– AIåŠŸèƒ½</h3>
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" id="enableAiNaming" class="form-check-input">
                            <label for="enableAiNaming" class="form-check-label">å¯ç”¨AIæ™ºèƒ½å‘½å</label>
                        </div>
                        <small>å¯ç”¨åï¼Œåˆ›å»ºM3U8ä»»åŠ¡æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨AIä¼˜åŒ–ç”µå½±åç§°</small>
                    </div>
                </div>
            </div>

            <div class="settings-actions">
                <button id="saveSettingsBtn" class="btn btn-primary">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
                <button id="resetSettingsBtn" class="btn btn-warning">ğŸ”„ é‡ç½®é»˜è®¤</button>
                <button id="closeSettingsBtn" class="btn btn-secondary">âŒ å…³é—­</button>
            </div>
        </section>

        <!-- æ·»åŠ æ–°ä»»åŠ¡ -->
        <section class="add-task-section">
            <h2>ğŸ“¥ æ·»åŠ ä¸‹è½½ä»»åŠ¡</h2>
            <div class="form-row">
                <div class="form-group flex-grow">
                    <label for="m3u8Url">M3U8 é“¾æ¥:</label>
                    <input type="url" id="m3u8Url" placeholder="è¯·è¾“å…¥M3U8é“¾æ¥" class="form-control">
                </div>
                <div class="form-group">
                    <label for="taskThreadCount">çº¿ç¨‹æ•°:</label>
                    <input type="number" id="taskThreadCount" class="form-control" min="1" max="16" value="6" style="width: 80px;">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="taskTitle">ä»»åŠ¡æ ‡é¢˜:</label>
                    <input type="text" id="taskTitle" placeholder="å¯é€‰ï¼Œç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆ" class="form-control">
                </div>
                <div class="form-group">
                    <label for="customDir">è‡ªå®šä¹‰ç›®å½•:</label>
                    <input type="text" id="customDir" placeholder="å¯é€‰ï¼Œè‡ªå®šä¹‰ä¸‹è½½ç›®å½•" class="form-control">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group flex-grow">
                    <label for="sourceUrl">æ¥æºé¡µé¢URL:</label>
                    <input type="url" id="sourceUrl" placeholder="å¯é€‰ï¼ŒåŸå§‹æ’­æ”¾é¡µé¢URL" class="form-control">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group flex-grow">
                    <label for="requestHeaders">è‡ªå®šä¹‰è¯·æ±‚å¤´ (JSONæ ¼å¼):</label>
                    <textarea id="requestHeaders" placeholder="å¯é€‰ï¼Œä¾‹å¦‚: {\"Referer\": \"https://example.com\", \"User-Agent\": \"Mozilla/5.0...\"}" class="form-control" rows="3"></textarea>
                    <small>æ”¯æŒè®¾ç½®Refererã€User-Agentç­‰è¯·æ±‚å¤´ï¼Œç”¨äºç»•è¿‡é˜²ç›—é“¾</small>
                </div>
            </div>
            <button id="addTaskBtn" class="btn btn-primary">ğŸš€ æ·»åŠ ä»»åŠ¡</button>
        </section>

        <!-- ä»»åŠ¡åˆ—è¡¨ -->
        <section class="tasks-section">
            <h2>ğŸ“‹ ä¸‹è½½ä»»åŠ¡åˆ—è¡¨</h2>
            <div class="tasks-header">
                <div class="tasks-header-left">
                    <button id="refreshBtn" class="btn btn-secondary">ğŸ”„ åˆ·æ–°</button>
                    <div class="refresh-status">
                        <span id="refreshIndicator" class="refresh-indicator">ğŸ”„</span>
                        <span id="refreshMode" class="refresh-mode">æ™ºèƒ½åˆ·æ–°</span>
                    </div>
                </div>
                <div class="tasks-header-center">
                    <div class="batch-controls">
                        <label class="batch-select-all">
                            <input type="checkbox" id="selectAllTasks"> å…¨é€‰
                        </label>
                        <div class="batch-actions">
                            <button id="batchPauseBtn" class="btn btn-warning" disabled>â¸ï¸ æ‰¹é‡æš‚åœ</button>
                            <button id="batchResumeBtn" class="btn btn-success" disabled>â–¶ï¸ æ‰¹é‡æ¢å¤</button>
                            <button id="batchConvertBtn" class="btn btn-info" disabled>ğŸ”„ æ‰¹é‡è½¬æ¢MP4</button>
                            <button id="batchDeleteBtn" class="btn btn-danger" disabled>ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                        </div>
                        <span id="selectedCount" class="selected-count">å·²é€‰æ‹© 0 ä¸ªä»»åŠ¡</span>
                    </div>
                </div>
                <div class="tasks-header-right">
                    <span id="taskCount" class="task-count">å…± 0 ä¸ªä»»åŠ¡</span>
                </div>
            </div>
            <div id="tasksList" class="tasks-list">
                <!-- ä»»åŠ¡é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>
        </section>

    <!-- æ’­æ”¾æ¨¡æ€æ¡† -->
    <!-- å·²åºŸå¼ƒï¼Œç›´æ¥è·³è½¬åŸå§‹ç½‘é¡µï¼Œæ— éœ€å¼¹çª— -->

    <!-- ç¼–è¾‘ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>ç¼–è¾‘ä»»åŠ¡</h3>
            <div class="form-group">
                <label for="editUrl">M3U8 é“¾æ¥:</label>
                <input type="url" id="editUrl" class="form-control">
            </div>
            <div class="form-group">
                <label for="editTitle">ä»»åŠ¡æ ‡é¢˜:</label>
                <input type="text" id="editTitle" class="form-control">
            </div>
            <div class="modal-actions">
                <button id="saveEditBtn" class="btn btn-primary">ğŸ’¾ ä¿å­˜</button>
                <button id="cancelEditBtn" class="btn btn-secondary">âŒ å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡è½¬æ¢è¿›åº¦æ¨¡æ€æ¡† -->
    <div id="batchConvertModal" class="modal batch-convert-modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>ğŸ”„ æ‰¹é‡è½¬æ¢è¿›åº¦</h3>
            <div class="convert-summary">
                <p>æ­£åœ¨ä¸²è¡Œè½¬æ¢é€‰ä¸­çš„ä»»åŠ¡ï¼Œè¯·è€å¿ƒç­‰å¾…...</p>
                <div class="progress-summary">
                    <span>æ€»è¿›åº¦: </span>
                    <span id="convertOverallProgress">0/0</span>
                    <span> | å½“å‰: </span>
                    <span id="convertCurrentTask">ç­‰å¾…å¼€å§‹...</span>
                </div>
            </div>
            <div id="convertProgressList" class="convert-progress-list">
                <!-- è½¬æ¢è¿›åº¦é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>
            <div class="modal-actions">
                <button id="stopBatchConvertBtn" class="btn btn-warning">â¹ï¸ åœæ­¢è½¬æ¢</button>
                <button id="closeBatchConvertBtn" class="btn btn-secondary" disabled>âŒ å…³é—­</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
    // é¦–é¡µä¸“ç”¨JavaScriptå‡½æ•°
    function toggleSettings() {
        const panel = document.getElementById('settingsPanel');
        if (panel) {
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
    }

    function showQueueStatusModal() {
        const btn = document.getElementById('queueStatusBtn');
        if (btn) {
            btn.click();
        }
    }

    // ç»‘å®šè®¾ç½®æŒ‰é’®äº‹ä»¶
    $(document).ready(function() {
        $('#settingsBtn').on('click', toggleSettings);
    });
</script>
{% endblock %}
